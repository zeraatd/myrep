<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conflict of Interest Declaration Form</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Arial', sans-serif;
            line-height: 1.6;
            color: #333;
            background-color: #f5f5f5;
            padding: 20px;
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            background: white;
            border-radius: 10px;
            box-shadow: 0 0 20px rgba(0,0,0,0.1);
            padding: 40px;
        }

        .header {
            text-align: center;
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 3px solid #4CAF50;
        }

        .header h1 {
            color: #2c3e50;
            font-size: 2.2em;
            margin-bottom: 10px;
        }

        .intro {
            background: #e8f5e8;
            padding: 20px;
            border-radius: 8px;
            margin-bottom: 30px;
        }

        .intro ul {
            columns: 2;
            list-style-type: disc;
            margin-left: 20px;
            margin-top: 10px;
        }

        .section {
            margin-bottom: 30px;
            padding: 20px;
            border: 1px solid #ddd;
            border-radius: 8px;
            background: #fafafa;
        }

        .section h2 {
            color: #2c3e50;
            font-size: 1.5em;
            margin-bottom: 15px;
            padding-bottom: 5px;
            border-bottom: 2px solid #4CAF50;
        }

        .section h3 {
            color: #34495e;
            font-size: 1.2em;
            margin: 20px 0 10px 0;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: bold;
            color: #2c3e50;
        }

        .form-group input[type="text"],
        .form-group input[type="email"],
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 5px;
            font-size: 16px;
        }

        .form-group textarea {
            height: 100px;
            resize: vertical;
        }

        .radio-group {
            display: flex;
            gap: 15px;
            align-items: center;
            margin-top: 5px;
        }

        .radio-group input[type="radio"] {
            margin-right: 5px;
        }

        .checkbox-group {
            display: flex;
            flex-wrap: wrap;
            gap: 15px;
            margin-top: 5px;
        }

        .checkbox-group label {
            display: flex;
            align-items: center;
            font-weight: normal;
            cursor: pointer;
        }

        .checkbox-group input[type="checkbox"] {
            margin-right: 5px;
        }

        .other-input {
            width: 100%;
            margin-top: 10px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background-color: #f9f9f9;
            display: none;
        }

        .other-input:focus {
            background-color: white;
            border-color: #4CAF50;
            outline: none;
            box-shadow: 0 0 0 2px rgba(76, 175, 80, 0.2);
        }

        .details-section {
            display: none;
            margin-top: 20px;
            padding: 20px;
            background: white;
            border: 2px solid #4CAF50;
            border-radius: 5px;
        }

        .details-section.show {
            display: block;
            animation: fadeIn 0.3s ease-in-out;
        }

        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }

        .button-group {
            text-align: center;
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px solid #ddd;
        }

        .btn {
            background: #4CAF50;
            color: white;
            padding: 12px 30px;
            border: none;
            border-radius: 5px;
            font-size: 16px;
            cursor: pointer;
            margin: 0 10px;
            transition: background 0.3s ease;
        }

        .btn:hover {
            background: #45a049;
        }

        .btn-secondary {
            background: #6c757d;
        }

        .btn-secondary:hover {
            background: #5a6268;
        }

        .warning {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            color: #856404;
            padding: 15px;
            border-radius: 5px;
            margin-bottom: 20px;
        }

        .required {
            color: red;
        }

        .conditional-required:invalid,
        .conditional-required.error {
            border-color: #dc3545 !important;
            box-shadow: 0 0 0 0.2rem rgba(220, 53, 69, 0.25);
        }

        .conditional-required:valid {
            border-color: #28a745;
        }

        @media (max-width: 768px) {
            .container {
                padding: 20px;
            }
            
            .intro ul {
                columns: 1;
            }
            
            .radio-group {
                flex-direction: column;
                align-items: flex-start;
            }
        }

        @media print {
            body {
                background: white;
                padding: 0;
            }
            
            .container {
                box-shadow: none;
                border: 1px solid #000;
            }
            
            .button-group {
                display: none;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>Conflict of Interest Declaration Form</h1>
        </div>

        <form id="coiForm">
            <div class="intro">
                <h2>Introduction</h2>
                <p>The development of recommendations necessitates subjective judgments about benefits, harms, the certainty of the evidence, and patient values and preferences. To ensure such judgments are not unduly influenced, we ask that you please disclose all relationships, activities, and interests that may be related to the proposed project.</p>
                
                <h3>Categories of potential conflicts include:</h3>
                <ul>
                    <li>Board Membership</li>
                    <li>Consultancies</li>
                    <li>Employment</li>
                    <li>Expert Testimony</li>
                    <li>Grants/Pending Grants</li>
                    <li>Contracted Research</li>
                    <li>Lectures and other Educational Events</li>
                    <li>Development of Educational Material</li>
                    <li>Manuscript Preparation</li>
                    <li>Patents</li>
                    <li>Receipt of Equipment or Supplies</li>
                    <li>Royalties</li>
                    <li>Stock and Ownership</li>
                    <li>Expenses and hospitality</li>
                </ul>
                
                <div class="warning">
                    <strong>Please note:</strong> This declaration can take up to 30 minutes to completeâ€”though this process will be quicker for authors with fewer conflicts of interest. The information collected in this form may be presented in supplementary materials.
                </div>
            </div>

            <!-- Author Information Section -->
            <div class="section">
                <h2>Author Information</h2>
                
                <div class="form-group">
                    <label for="projectName">Project/Guideline/Research Name <span class="required">*</span></label>
                    <input type="text" id="projectName" name="projectName" placeholder="e.g., HAHSO Grant Guidelines, XYZ Clinical Study, ABC Research Protocol" required>
                </div>
                
                <div class="form-group">
                    <label for="givenName">Given Name <span class="required">*</span></label>
                    <input type="text" id="givenName" name="givenName" required>
                </div>
                
                <div class="form-group">
                    <label for="surname">Surname <span class="required">*</span></label>
                    <input type="text" id="surname" name="surname" required>
                </div>
                
                <div class="form-group">
                    <label for="email">Email Address <span class="required">*</span></label>
                    <input type="email" id="email" name="email" required>
                </div>
                
                <div class="form-group">
                    <label for="specialty">Specialty/Field</label>
                    <input type="text" id="specialty" name="specialty" placeholder="e.g., 'Cardiology', 'Primary Care', 'Research'">
                </div>
                
                <div class="form-group">
                    <label for="institution">Primary Institution <span class="required">*</span></label>
                    <input type="text" id="institution" name="institution" required>
                </div>
                
                <div class="form-group">
                    <label for="jobTitle">Job Title</label>
                    <input type="text" id="jobTitle" name="jobTitle">
                </div>
            </div>

            <!-- Disclosure Timeframe -->
            <div class="section">
                <h2>Disclosure Timeframe</h2>
                <p><strong>Timeframe:</strong> The preceding 5 years and the anticipated activities for the next 3 years.</p>
                <p><strong>Financial conflicts:</strong> Please disclose conflicts of spouses and/or children that may influence or appear to influence your work in the proposed project.</p>
            </div>

            <!-- Board Membership Section -->
            <div class="section">
                <h2>Board Membership</h2>
                <p><em>(e.g., advisory board, management board)</em></p>
                
                <div class="form-group">
                    <label>For the preceding 5 years and the next 3 years from today, have you been/will you be a member of a board?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="boardMember" value="yes" onclick="toggleDetails('boardDetails')"> Yes</label>
                        <label><input type="radio" name="boardMember" value="no" onclick="toggleDetails('boardDetails')"> No</label>
                    </div>
                </div>
                
                <div id="boardDetails" class="details-section">
                    <h3>Board Membership Details</h3>
                    <div class="form-group">
                        <label for="boardOrganization">What is the name and role of the organization(s)? <span class="required">*</span></label>
                        <textarea id="boardOrganization" name="boardOrganization" placeholder="e.g., XX Company, produces pharmaceuticals for XYZ disease" class="conditional-required" data-section="boardMember"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="boardType">What is the type of board? What is the board's role? <span class="required">*</span></label>
                        <textarea id="boardType" name="boardType" placeholder="e.g., Advisory board, management board" class="conditional-required" data-section="boardMember"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="boardRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="boardRelation" name="boardRelation" class="conditional-required" data-section="boardMember"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Is there a contractual agreement to disseminate product information?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="boardContract" value="yes"> Yes</label>
                            <label><input type="radio" name="boardContract" value="no"> No</label>
                            <label><input type="radio" name="boardContract" value="other" onclick="toggleOtherInput('boardContractOther')"> Other</label>
                        </div>
                        <input type="text" id="boardContractOther" name="boardContractOther" placeholder="Please specify" class="other-input">
                    </div>
                    <div class="form-group">
                        <label>Did/will you receive payment(s)?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="boardPayment" value="yes"> Yes</label>
                            <label><input type="radio" name="boardPayment" value="no"> No</label>
                            <label><input type="radio" name="boardPayment" value="other" onclick="toggleOtherInput('boardPaymentOther')"> Other</label>
                        </div>
                        <input type="text" id="boardPaymentOther" name="boardPaymentOther" placeholder="Please specify" class="other-input">
                    </div>
                    <div class="form-group">
                        <label>Did/will your institution receive payment(s)?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="boardInstitutionPayment" value="yes"> Yes</label>
                            <label><input type="radio" name="boardInstitutionPayment" value="no"> No</label>
                            <label><input type="radio" name="boardInstitutionPayment" value="other" onclick="toggleOtherInput('boardInstitutionPaymentOther')"> Other</label>
                        </div>
                        <input type="text" id="boardInstitutionPaymentOther" name="boardInstitutionPaymentOther" placeholder="Please specify" class="other-input">
                    </div>
                </div>
            </div>

            <!-- Consultancy Section -->
            <div class="section">
                <h2>Consultancy</h2>
                
                <div class="form-group">
                    <label>For the preceding 5 years and the next 3 years have you had/will you have a consultancy?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="consultancy" value="yes" onclick="toggleDetails('consultancyDetails')"> Yes</label>
                        <label><input type="radio" name="consultancy" value="no" onclick="toggleDetails('consultancyDetails')"> No</label>
                    </div>
                </div>
                
                <div id="consultancyDetails" class="details-section">
                    <h3>Consultancy Details</h3>
                    <div class="form-group">
                        <label for="consultancyOrganization">What is the name and role of the organizations? <span class="required">*</span></label>
                        <textarea id="consultancyOrganization" name="consultancyOrganization" placeholder="e.g., AA Company, produces products for XYZ condition" class="conditional-required" data-section="consultancy"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="consultancyNature">What is the nature of the consultancy? <span class="required">*</span></label>
                        <textarea id="consultancyNature" name="consultancyNature" placeholder="e.g., Advised on development of new treatment for XYZ" class="conditional-required" data-section="consultancy"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="consultancyRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="consultancyRelation" name="consultancyRelation" class="conditional-required" data-section="consultancy"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Is there a contractual agreement to disseminate product information?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="consultancyContract" value="yes"> Yes</label>
                            <label><input type="radio" name="consultancyContract" value="no"> No</label>
                            <label><input type="radio" name="consultancyContract" value="other" onclick="toggleOtherInput('consultancyContractOther')"> Other</label>
                        </div>
                        <input type="text" id="consultancyContractOther" name="consultancyContractOther" placeholder="Please specify" class="other-input">
                    </div>
                    <div class="form-group">
                        <label>Did/will you receive payment(s)?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="consultancyPayment" value="yes"> Yes</label>
                            <label><input type="radio" name="consultancyPayment" value="no"> No</label>
                            <label><input type="radio" name="consultancyPayment" value="other" onclick="toggleOtherInput('consultancyPaymentOther')"> Other</label>
                        </div>
                        <input type="text" id="consultancyPaymentOther" name="consultancyPaymentOther" placeholder="Please specify" class="other-input">
                    </div>
                    <div class="form-group">
                        <label>Did/will your institution receive payment(s)?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="consultancyInstitutionPayment" value="yes"> Yes</label>
                            <label><input type="radio" name="consultancyInstitutionPayment" value="no"> No</label>
                            <label><input type="radio" name="consultancyInstitutionPayment" value="other" onclick="toggleOtherInput('consultancyInstitutionPaymentOther')"> Other</label>
                        </div>
                        <input type="text" id="consultancyInstitutionPaymentOther" name="consultancyInstitutionPaymentOther" placeholder="Please specify" class="other-input">
                    </div>
                </div>
            </div>

            <!-- Employment Section -->
            <div class="section">
                <h2>Employment</h2>
                
                <div class="form-group">
                    <label>For the preceding 5 years and the next 3 years has/will any employer had/have an interest in the topic covered?</label>
                    <p><em>(You are not required to state any roles you have already mentioned)</em></p>
                    <div class="radio-group">
                        <label><input type="radio" name="employment" value="yes" onclick="toggleDetails('employmentDetails')"> Yes</label>
                        <label><input type="radio" name="employment" value="no" onclick="toggleDetails('employmentDetails')"> No</label>
                    </div>
                </div>
                
                <div id="employmentDetails" class="details-section">
                    <h3>Employment Details</h3>
                    <div class="form-group">
                        <label for="employmentOrganization">What is the name of the organization? <span class="required">*</span></label>
                        <input type="text" id="employmentOrganization" name="employmentOrganization" placeholder="e.g., AA Company" class="conditional-required" data-section="employment">
                    </div>
                    <div class="form-group">
                        <label for="employmentRole">What is the organization's role? <span class="required">*</span></label>
                        <textarea id="employmentRole" name="employmentRole" placeholder="e.g., Produces pharmaceuticals for XYZ disease" class="conditional-required" data-section="employment"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="employmentRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="employmentRelation" name="employmentRelation" class="conditional-required" data-section="employment"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="employmentAdditional">Additional employers (if any):</label>
                        <textarea id="employmentAdditional" name="employmentAdditional" placeholder="Please provide the same information for any additional employers"></textarea>
                    </div>
                </div>
            </div>

            <!-- Expert Testimony Section -->
            <div class="section">
                <h2>Expert Testimony</h2>
                
                <div class="form-group">
                    <label>For the preceding 5 years and the next 3 years have you given, or are expecting to give relevant expert testimony?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="expertTestimony" value="yes" onclick="toggleDetails('expertDetails')"> Yes</label>
                        <label><input type="radio" name="expertTestimony" value="no" onclick="toggleDetails('expertDetails')"> No</label>
                    </div>
                </div>
                
                <div id="expertDetails" class="details-section">
                    <h3>Expert Testimony Details</h3>
                    <div class="form-group">
                        <label for="expertOrganization">Expert testimony for which organization(s)? <span class="required">*</span></label>
                        <textarea id="expertOrganization" name="expertOrganization" placeholder="e.g., Expert witness on behalf of organization in legal claim" class="conditional-required" data-section="expertTestimony"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="expertRole">What is the organization's role? <span class="required">*</span></label>
                        <textarea id="expertRole" name="expertRole" class="conditional-required" data-section="expertTestimony"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="expertRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="expertRelation" name="expertRelation" class="conditional-required" data-section="expertTestimony"></textarea>
                    </div>
                </div>
            </div>

            <!-- Grants Section -->
            <div class="section">
                <h2>Grants/Grants Pending</h2>
                
                <div class="form-group">
                    <label>Have you received, or are expecting to receive grants from a non-government organization over the past 5 years and the next 3 years?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="grants" value="yes" onclick="toggleDetails('grantsDetails')"> Yes</label>
                        <label><input type="radio" name="grants" value="no" onclick="toggleDetails('grantsDetails')"> No</label>
                    </div>
                </div>
                
                <div id="grantsDetails" class="details-section">
                    <h3>Grant Details</h3>
                    <div class="form-group">
                        <label for="grantsOrganization">Grants were received from which organization(s)? <span class="required">*</span></label>
                        <textarea id="grantsOrganization" name="grantsOrganization" placeholder="e.g., AA Company" class="conditional-required" data-section="grants"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="grantsRole">What is the organization's role? <span class="required">*</span></label>
                        <textarea id="grantsRole" name="grantsRole" placeholder="If funding was for a study, please specify whether or not the organization had any role in: study design; data collection, access analysis, or interpretation; writing of the report; or the decision to publish." class="conditional-required" data-section="grants"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="grantsRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="grantsRelation" name="grantsRelation" class="conditional-required" data-section="grants"></textarea>
                    </div>
                </div>
            </div>

            <!-- Other sections would continue here with similar patterns... -->
            <!-- For brevity, I'll include a few more key sections and then the intellectual interests and confirmation -->

            <!-- Patents Section -->
            <div class="section">
                <h2>Patents</h2>
                <p><em>(Whether planned, pending, or issued)</em></p>
                
                <div class="form-group">
                    <label>Have you planned, submitted or been awarded a patent over the preceding 5 years and the next 3 years?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="patents" value="yes" onclick="toggleDetails('patentsDetails')"> Yes</label>
                        <label><input type="radio" name="patents" value="no" onclick="toggleDetails('patentsDetails')"> No</label>
                    </div>
                </div>
                
                <div id="patentsDetails" class="details-section">
                    <h3>Patent Details</h3>
                    <div class="form-group">
                        <label for="patentsProduct">Patents were prepared for which product(s)? <span class="required">*</span></label>
                        <textarea id="patentsProduct" name="patentsProduct" class="conditional-required" data-section="patents"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="patentsManufacturer">What is the role of the product and the manufacturer? <span class="required">*</span></label>
                        <textarea id="patentsManufacturer" name="patentsManufacturer" class="conditional-required" data-section="patents"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="patentsRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="patentsRelation" name="patentsRelation" class="conditional-required" data-section="patents"></textarea>
                    </div>
                    <div class="form-group">
                        <label>Is this patent licensed or unlicensed?</label>
                        <div class="radio-group">
                            <label><input type="radio" name="patentsLicense" value="licensed"> Licensed</label>
                            <label><input type="radio" name="patentsLicense" value="unlicensed"> Unlicensed</label>
                            <label><input type="radio" name="patentsLicense" value="other" onclick="toggleOtherInput('patentsLicenseOther')"> Other</label>
                        </div>
                        <input type="text" id="patentsLicenseOther" name="patentsLicenseOther" placeholder="Please specify" class="other-input">
                    </div>
                </div>
            </div>

            <!-- Intellectual Interests Section -->
            <div class="section">
                <h2>Intellectual Interests</h2>
                <p><em>The questions that follow will elicit information about personal beliefs, intellectual positions or opinions, institutional relationships, and other interests that are not mainly financial.</em></p>
                
                <div class="form-group">
                    <label for="personalBeliefs">Personal Beliefs</label>
                    <p>Do you have strongly held beliefs related to the project? If yes, please detail.</p>
                    <textarea id="personalBeliefs" name="personalBeliefs"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="publishedOpinions">Previously Published Opinions</label>
                    <p>Have you ever authored, coauthored, or publicly provided an opinion related to the project topic, e.g., a clinical practice guideline, textbook, review article, meeting poster or presentation, public lectures or letter to editor? If yes, please detail.</p>
                    <textarea id="publishedOpinions" name="publishedOpinions"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="institutionalRelationships">Institutional Relationships</label>
                    <p>Could your institution benefit or be harmed by this project, or do you generate revenues or non-financial benefits for your institution by sharing your knowledge or opinions on the topic? If yes, please detail.</p>
                    <textarea id="institutionalRelationships" name="institutionalRelationships"></textarea>
                </div>
                
                <div class="form-group">
                    <label for="advocacyPositions">Advocacy and Policy Positions</label>
                    <p>Do you work for or are you a member of an organization with a stated position related to the project topic e.g., position statement, editorial, blog, legislature or legal testimony? If yes, please provide details.</p>
                    <textarea id="advocacyPositions" name="advocacyPositions"></textarea>
                </div>
            </div>

            <!-- Other Relationships Section -->
            <div class="section">
                <h2>Other Personal or Professional Relationships</h2>
                <p><em>Err on the side of full disclosure, including:</em></p>
                <ul>
                    <li>Relevant, non-financial relationships</li>
                    <li>Personal relationships with authors or editors of material including having held grants, co-authored articles or papers, or worked together</li>
                </ul>
                
                <div class="form-group">
                    <label>Do you have any other personal or professional relationships to declare?</label>
                    <div class="radio-group">
                        <label><input type="radio" name="otherRelationships" value="yes" onclick="toggleDetails('otherDetails')"> Yes</label>
                        <label><input type="radio" name="otherRelationships" value="no" onclick="toggleDetails('otherDetails')"> No</label>
                    </div>
                </div>
                
                <div id="otherDetails" class="details-section">
                    <h3>Other Relationships Details</h3>
                    <div class="form-group">
                        <label for="otherPersonOrganization">Please describe the person(s) or organization(s) involved <span class="required">*</span></label>
                        <textarea id="otherPersonOrganization" name="otherPersonOrganization" placeholder="e.g., AA Company" class="conditional-required" data-section="otherRelationships"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="otherRole">What is the person/organization's role? <span class="required">*</span></label>
                        <textarea id="otherRole" name="otherRole" class="conditional-required" data-section="otherRelationships"></textarea>
                    </div>
                    <div class="form-group">
                        <label for="otherRelation">How does the interest relate to the project? <span class="required">*</span></label>
                        <textarea id="otherRelation" name="otherRelation" class="conditional-required" data-section="otherRelationships"></textarea>
                    </div>
                </div>
            </div>

            <!-- Confirmation Section -->
            <div class="section">
                <h2>Confirmation Statement</h2>
                <div class="warning">
                    <strong>Please be aware that this is the final section of your declaration. Please be sure you have completed all sections accordingly before submitting.</strong>
                </div>
                
                <div class="form-group">
                    <label for="confirmation">I confirm that the information I have provided in this declaration is accurate. Please accept this as my signature.</label>
                    <input type="text" id="confirmation" name="confirmation" placeholder="Type your full name as signature" required>
                </div>
                
                <div class="form-group">
                    <label for="date">Date <span class="required">*</span></label>
                    <input type="date" id="date" name="date" required>
                </div>
            </div>

            <!-- Buttons -->
            <div class="button-group">
                <button type="button" class="btn btn-secondary" onclick="resetForm()">Clear Form</button>
                <button type="button" class="btn" onclick="validateAndExportPDF()">Export to PDF</button>
            </div>
        </form>
    </div>

    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script>
        function toggleDetails(detailsId) {
            // Map detail section IDs to their corresponding radio button names
            const radioNameMap = {
                'boardDetails': 'boardMember',
                'consultancyDetails': 'consultancy',
                'employmentDetails': 'employment',
                'expertDetails': 'expertTestimony',
                'grantsDetails': 'grants',
                'patentsDetails': 'patents',
                'otherDetails': 'otherRelationships'
            };
            
            const radioName = radioNameMap[detailsId];
            const radioButtons = document.querySelectorAll(`input[name="${radioName}"]:checked`);
            const detailsSection = document.getElementById(detailsId);
            
            // Clear any validation error styling when toggling
            const conditionalFields = detailsSection.querySelectorAll('.conditional-required');
            conditionalFields.forEach(field => {
                field.style.borderColor = '#ddd';
                field.classList.remove('error');
            });
            
            if (radioButtons.length > 0) {
                if (radioButtons[0].value === 'yes') {
                    detailsSection.classList.add('show');
                } else {
                    detailsSection.classList.remove('show');
                    // Clear values when hiding section
                    conditionalFields.forEach(field => {
                        field.value = '';
                    });
                }
            }
        }

        function toggleOtherInput(inputId) {
            const otherInput = document.getElementById(inputId);
            const radioGroup = otherInput.previousElementSibling;
            const otherRadio = radioGroup.querySelector(`input[value="other"]`);
            
            // Hide all other inputs in the same group first
            const allOtherInputs = radioGroup.parentElement.querySelectorAll('input[type="text"][id$="Other"]');
            allOtherInputs.forEach(input => {
                if (input.id !== inputId) {
                    input.style.display = 'none';
                    input.value = '';
                }
            });
            
            if (otherRadio && otherRadio.checked) {
                otherInput.style.display = 'block';
                otherInput.focus();
            } else {
                otherInput.style.display = 'none';
                otherInput.value = '';
            }
        }

        // Add event listeners to all radio buttons to hide "Other" inputs when not selected
        document.addEventListener('DOMContentLoaded', function() {
            const radioButtons = document.querySelectorAll('input[type="radio"]');
            radioButtons.forEach(radio => {
                radio.addEventListener('change', function() {
                    if (this.value !== 'other' && this.name.includes('Contract') || 
                        this.value !== 'other' && this.name.includes('Payment') || 
                        this.value !== 'other' && this.name.includes('License')) {
                        const otherInput = this.closest('.form-group').querySelector('input[type="text"][id$="Other"]');
                        if (otherInput) {
                            otherInput.style.display = 'none';
                            otherInput.value = '';
                        }
                    }
                });
            });
        });

        function resetForm() {
            if (confirm('Are you sure you want to clear all form data? This action cannot be undone.')) {
                document.getElementById('coiForm').reset();
                // Hide all details sections
                const detailsSections = document.querySelectorAll('.details-section');
                detailsSections.forEach(section => {
                    section.classList.remove('show');
                });
                // Hide all "Other" input fields
                const otherInputs = document.querySelectorAll('.other-input');
                otherInputs.forEach(input => {
                    input.style.display = 'none';
                    input.value = '';
                });
                // Clear all validation styling
                const allFields = document.querySelectorAll('input, textarea, select');
                allFields.forEach(field => {
                    field.style.borderColor = '#ddd';
                    field.classList.remove('error');
                });
            }
        }

        function validateAndExportPDF() {
            let allValid = true;
            let errorMessages = [];
            
            // Basic validation for always-required fields
            const requiredFields = document.querySelectorAll('input[required]');
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    allValid = false;
                    field.style.borderColor = 'red';
                } else {
                    field.style.borderColor = '#ddd';
                }
            });

            // Conditional validation for sections where "Yes" is selected
            const conditionalSections = [
                { radio: 'boardMember', section: 'Board Membership' },
                { radio: 'consultancy', section: 'Consultancy' },
                { radio: 'employment', section: 'Employment' },
                { radio: 'expertTestimony', section: 'Expert Testimony' },
                { radio: 'grants', section: 'Grants' },
                { radio: 'patents', section: 'Patents' },
                { radio: 'otherRelationships', section: 'Other Relationships' }
            ];

            conditionalSections.forEach(({ radio, section }) => {
                const radioButton = document.querySelector(`input[name="${radio}"]:checked`);
                if (radioButton && radioButton.value === 'yes') {
                    const conditionalFields = document.querySelectorAll(`.conditional-required[data-section="${radio}"]`);
                    let sectionHasErrors = false;
                    
                    conditionalFields.forEach(field => {
                        if (!field.value.trim()) {
                            allValid = false;
                            sectionHasErrors = true;
                            field.style.borderColor = 'red';
                        } else {
                            field.style.borderColor = '#ddd';
                        }
                    });
                    
                    if (sectionHasErrors) {
                        errorMessages.push(`${section} section requires details since you selected "Yes"`);
                    }
                }
            });

            if (!allValid) {
                let message = 'Please fill in all required fields before exporting to PDF.';
                if (errorMessages.length > 0) {
                    message += '\n\nSpecifically:\nâ€¢ ' + errorMessages.join('\nâ€¢ ');
                }
                alert(message);
                return;
            }

            // Generate PDF
            generatePDF();
        }

        function generatePDF() {
            const { jsPDF } = window.jspdf;
            const doc = new jsPDF();
            
            // Set font
            doc.setFont('helvetica');
            
            // Title
            doc.setFontSize(20);
            doc.setFont('helvetica', 'bold');
            doc.text('Conflict of Interest Declaration', 20, 30);
            
            // Project name
            const projectName = document.getElementById('projectName').value;
            if (projectName) {
                doc.setFontSize(14);
                doc.setFont('helvetica', 'bold');
                doc.text(`Project: ${projectName}`, 20, 45);
                yPosition = 65;
            } else {
                yPosition = 50;
            }
            
            doc.setFontSize(12);
            doc.setFont('helvetica', 'normal');
            
            const lineHeight = 7;
            const leftMargin = 20;
            const rightMargin = 190;
            
            // Helper function to add text with word wrapping
            function addWrappedText(text, y, isBold = false) {
                if (isBold) doc.setFont('helvetica', 'bold');
                else doc.setFont('helvetica', 'normal');
                
                const splitText = doc.splitTextToSize(text, rightMargin - leftMargin);
                doc.text(splitText, leftMargin, y);
                return y + (splitText.length * lineHeight);
            }
            
            // Helper function to check if we need a new page
            function checkNewPage(currentY, needed = 20) {
                if (currentY + needed > 280) {
                    doc.addPage();
                    return 30;
                }
                return currentY;
            }
            
            // Author Information
            yPosition = addWrappedText('AUTHOR INFORMATION', yPosition, true);
            yPosition += 5;
            
            const givenName = document.getElementById('givenName').value;
            const surname = document.getElementById('surname').value;
            const email = document.getElementById('email').value;
            const specialty = document.getElementById('specialty').value;
            const institution = document.getElementById('institution').value;
            const jobTitle = document.getElementById('jobTitle').value;
            
            if (projectName) yPosition = addWrappedText(`Project: ${projectName}`, yPosition);
            if (givenName) yPosition = addWrappedText(`Name: ${givenName} ${surname}`, yPosition);
            if (email) yPosition = addWrappedText(`Email: ${email}`, yPosition);
            if (specialty) yPosition = addWrappedText(`Specialty: ${specialty}`, yPosition);
            if (institution) yPosition = addWrappedText(`Institution: ${institution}`, yPosition);
            if (jobTitle) yPosition = addWrappedText(`Job Title: ${jobTitle}`, yPosition);
            
            yPosition += 10;
            yPosition = checkNewPage(yPosition);
            
            // Function to add section data
            function addSectionData(sectionName, radioName, detailsId) {
                yPosition = checkNewPage(yPosition);
                yPosition = addWrappedText(sectionName.toUpperCase(), yPosition, true);
                yPosition += 5;
                
                const radioValue = document.querySelector(`input[name="${radioName}"]:checked`);
                if (radioValue) {
                    yPosition = addWrappedText(`Response: ${radioValue.value}`, yPosition);
                    
                    if (radioValue.value === 'yes') {
                        const detailsSection = document.getElementById(detailsId);
                        if (detailsSection && detailsSection.classList.contains('show')) {
                            const textareas = detailsSection.querySelectorAll('textarea, input[type="text"]:not(.other-input)');
                            textareas.forEach(textarea => {
                                if (textarea.value.trim()) {
                                    const label = textarea.previousElementSibling || textarea.closest('.form-group').querySelector('label');
                                    const labelText = label ? label.textContent.replace('*', '').trim() : 'Details';
                                    yPosition = addWrappedText(`${labelText}: ${textarea.value}`, yPosition);
                                    yPosition += 3;
                                }
                            });
                            
                            // Add "Other" responses for radio button questions
                            const radioGroups = detailsSection.querySelectorAll('.radio-group');
                            radioGroups.forEach(group => {
                                const checkedRadio = group.querySelector('input[type="radio"]:checked');
                                if (checkedRadio) {
                                    const questionLabel = group.previousElementSibling;
                                    const questionText = questionLabel ? questionLabel.textContent.trim() : 'Question';
                                    let answer = checkedRadio.value;
                                    
                                    if (checkedRadio.value === 'other') {
                                        const otherInput = group.nextElementSibling;
                                        if (otherInput && otherInput.classList.contains('other-input') && otherInput.value.trim()) {
                                            answer = `Other: ${otherInput.value}`;
                                        }
                                    }
                                    
                                    yPosition = addWrappedText(`${questionText}: ${answer}`, yPosition);
                                    yPosition += 3;
                                }
                            });
                        }
                    }
                } else {
                    yPosition = addWrappedText('Response: Not answered', yPosition);
                }
                yPosition += 8;
            }
            
            // Add all sections
            addSectionData('Board Membership', 'boardMember', 'boardDetails');
            addSectionData('Consultancy', 'consultancy', 'consultancyDetails');
            addSectionData('Employment', 'employment', 'employmentDetails');
            addSectionData('Expert Testimony', 'expertTestimony', 'expertDetails');
            addSectionData('Grants', 'grants', 'grantsDetails');
            addSectionData('Patents', 'patents', 'patentsDetails');
            
            // Intellectual Interests
            yPosition = checkNewPage(yPosition);
            yPosition = addWrappedText('INTELLECTUAL INTERESTS', yPosition, true);
            yPosition += 5;
            
            const intellectualFields = [
                { id: 'personalBeliefs', label: 'Personal Beliefs' },
                { id: 'publishedOpinions', label: 'Previously Published Opinions' },
                { id: 'institutionalRelationships', label: 'Institutional Relationships' },
                { id: 'advocacyPositions', label: 'Advocacy and Policy Positions' }
            ];
            
            intellectualFields.forEach(field => {
                const value = document.getElementById(field.id).value;
                if (value.trim()) {
                    yPosition = addWrappedText(`${field.label}: ${value}`, yPosition);
                    yPosition += 5;
                }
            });
            
            // Other Relationships
            yPosition = checkNewPage(yPosition);
            addSectionData('Other Personal/Professional Relationships', 'otherRelationships', 'otherDetails');
            
            // Confirmation
            yPosition = checkNewPage(yPosition);
            yPosition = addWrappedText('CONFIRMATION', yPosition, true);
            yPosition += 5;
            
            const confirmation = document.getElementById('confirmation').value;
            const date = document.getElementById('date').value;
            
            if (confirmation) yPosition = addWrappedText(`Signature: ${confirmation}`, yPosition);
            if (date) yPosition = addWrappedText(`Date: ${date}`, yPosition);
            
            // Save the PDF
            const projectPrefix = projectName ? projectName.replace(/[^a-zA-Z0-9]/g, '_').substring(0, 30) : 'Project';
            const fileName = `COI_Declaration_${projectPrefix}_${surname}_${givenName}_${new Date().toISOString().split('T')[0]}.pdf`;
            doc.save(fileName);
        }

        // Set today's date as default
        document.getElementById('date').valueAsDate = new Date();
    </script>
</body>
</html>
